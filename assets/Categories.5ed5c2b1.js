import{Q as D,a as j}from"./QForm.99edcc66.js";import{r as c,a2 as B,a4 as b,ag as h,ab as o,a6 as R,aL as q,f as F,ae as v,aJ as k,a as H,w as I,a5 as S,aM as _,al as J,af as L,ac as Q,ad as T,aN as G,aO as K,o as W}from"./index.a263a694.js";import{u as U,a as A,b as X,Q as Y,r as x}from"./index.esm.3f15bf5a.js";import{_ as Z}from"./ConfirmationModal.39911b64.js";import"./format.738cc702.js";const ee={class:"q-pa-md"},te=v("h5",{class:"q-pb-md"},"Create new product category",-1),ae={__name:"CreateCategory",emits:["createdCategory"],setup(V,{emit:g}){const{createCategoryInFirebase:d}=U(),{triggerNegative:p,triggerPositive:s}=A(),i=c(null),C=c(null),y=c(null);B();const r=()=>{i.value=null,C.value=null,y.value.reset()};function N(){y.value.validate().then(f=>{f?w():p("Please, fill in all the fields")})}const w=async()=>{let f={categoryName:i.value,categoryRoute:C.value};await d(f),s(`Category ${i.value} created`),g("createdCategory"),r()};return(f,l)=>(b(),h("div",ee,[te,o(D,{ref_key:"createCategoryForm",ref:y,onSubmit:N},{default:R(()=>[o(q,{class:"q-pb-lg",modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=u=>i.value=u),outlined:"",label:"Category name *","lazy-rules":"ondemand",rules:[u=>u&&u.length>0||"Name must be filled"]},null,8,["modelValue","rules"]),o(q,{class:"q-pb-lg",modelValue:C.value,"onUpdate:modelValue":l[1]||(l[1]=u=>C.value=u),outlined:"",label:"Route for category *",prefix:"/","lazy-rules":"ondemand",rules:[u=>u&&u.length>0||"Route must be filled in."]},null,8,["modelValue","rules"]),o(F,{unelevated:"",rounded:"",align:"between","icon-right":"check",color:"primary",label:"Create",type:"submit"})]),_:1},512)]))}},oe={class:"q-pa-md"},re=v("h5",{class:"q-pb-md"},"Edit Product Category",-1),le={key:1},se={key:2,class:"q-pb-lg"},ue={class:"row q-gutter-sm"},ne={class:"q-ml-sm"},ce={__name:"EditCategory",props:{categories:{type:Array,default:[]}},emits:["updatedCategory","deletedCategory"],setup(V,{emit:g}){const d=V,{updateCategoryInFirebase:p,deleteCategoryFromFirebase:s}=U(),{triggerPositive:i,triggerNegative:C}=A(),y=c(""),r=c(null),N=c([]),w=c(null),f=c(null),l=c(!1),u=c(""),n=k({categoryName:"",categoryRoute:""}),E={categoryName:{required:x},categoryRoute:{required:x}},m=k({categoryName:"",categoryRoute:""}),P=H(()=>n.categoryName!=m.categoryName||n.categoryRoute!=m.categoryRoute),$=X(E,n),z=async()=>{try{const a={categoryName:n.categoryName,categoryRoute:n.categoryRoute};y.value=K(r.value).value,await p(r.value,a),i("Cateogory updated"),m.categoryName="",m.categoryRoute="",g("updatedCategory",r.value)}catch(a){console.warn({error:a})}},M=()=>{N.value=[],r.value="",w.value="",f.value="",u.value.reset()},O=async()=>{if(l.value=!1,!l.value)try{await s(r.value),i(`${w.value} category deleted`),M(),m.categoryName="",m.categoryRoute="",g("deletedCategory",r.value)}catch(a){console.warn({error:a})}};return I(()=>d.categories,()=>{if(N.value=d.categories.map(a=>({label:a.categoryName,value:a.categoryId})),y.value){let a=d.categories.find(t=>t.categoryId===y.value),e={label:a.categoryName,value:a.categoryId};r.value=e,y.value=""}}),I(r,a=>{if(a.value){let e=d.categories.find(t=>t.categoryId===a.value);m.categoryName=e.categoryName,m.categoryRoute=e.categoryRoute,n.categoryName=e.categoryName,n.categoryRoute=e.categoryRoute}else return}),(a,e)=>(b(),h("div",oe,[re,o(D,{ref_key:"editCategoryForm",ref:u,onSubmit:z},{default:R(()=>[V.categories.length?(b(),S(Y,{key:0,class:"q-pb-lg",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),options:N.value,outlined:"",label:"Available categories"},null,8,["modelValue","options"])):(b(),h("p",le,"No categories. Create the first one on the left")),r.value?(b(),h("div",se,[o(q,{class:"q-pb-lg",modelValue:n.categoryName,"onUpdate:modelValue":e[1]||(e[1]=t=>n.categoryName=t),outlined:"",label:"Edit name","bottom-slots":"",onInput:e[2]||(e[2]=t=>_($).categoryName.$touch()),error:_($).categoryName.$invalid},null,8,["modelValue","error"]),o(q,{modelValue:n.categoryRoute,"onUpdate:modelValue":e[3]||(e[3]=t=>n.categoryRoute=t),prefix:"/",outlined:"",label:"Edit route","bottom-slots":"",onInput:e[4]||(e[4]=t=>_($).categoryRoute.$touch()),error:_($).categoryRoute.$invalid},null,8,["modelValue","error"]),v("div",ue,[o(F,{unelevated:"",rounded:"",align:"between",color:"primary","icon-right":"delete",label:"Delete",onClick:e[5]||(e[5]=t=>l.value=!0)}),o(F,{disable:!_(P),unelevated:"",rounded:"",align:"between","icon-right":"sync",color:"primary",label:"Update",type:"submit"},null,8,["disable"])])])):J("",!0)]),_:1},512),o(G,{modelValue:l.value,"onUpdate:modelValue":e[8]||(e[8]=t=>l.value=t)},{default:R(()=>[o(Z,{open:l.value,"onUpdate:open":e[6]||(e[6]=t=>l.value=t),onCancel:e[7]||(e[7]=t=>l.value=!1),onSubmit:O},{default:R(()=>[o(L,{icon:"error",color:"red","text-color":"white"}),v("span",ne,[Q("Are you sure you want to delete "),v("b",null,T(n.categoryName),1),Q(" ?")])]),_:1},8,["open"])]),_:1},8,["modelValue"])]))}},de={class:"row justify-center"},ie={class:"col-12 col-sm-6 col-md-4"},ge={class:"col-12 col-sm-6 col-md-4"},be={__name:"Categories",setup(V){B();const g=c([]),{getCategoryDocsFromFirebase:d}=U();W(async()=>{try{const{categoriesData:s}=await d();g.value=s.value}catch(s){console.warn({error:s})}});async function p(){try{const{categoriesData:s}=await d();g.value=s.value}catch(s){console.error({error:s})}}return(s,i)=>(b(),S(j,null,{default:R(()=>[v("div",de,[v("div",ie,[o(ae,{onCreatedCategory:p})]),v("div",ge,[o(ce,{categories:g.value,onUpdatedCategory:p,onDeletedCategory:p},null,8,["categories"])])])]),_:1}))}};export{be as default};
