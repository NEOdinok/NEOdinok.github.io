import{Q as B,a as J}from"./QForm.99edcc66.js";import{a as E,u as P,Q as k,b as L,r as Q}from"./index.esm.3f15bf5a.js";import{r as n,a2 as O,w,a4 as y,ag as R,ab as c,a6 as I,aL as F,f as U,al as h,ae as C,aJ as x,a as T,a5 as q,aM as V,af as G,ac as A,ad as K,aO as D,o as W}from"./index.a263a694.js";import{_ as X}from"./ConfirmationModal.39911b64.js";import"./format.738cc702.js";const Y={class:"q-pa-md"},Z=C("h5",{class:"q-pb-md"},"Create Product Subcategory",-1),ee={key:0,class:"q-pb-lg"},ae={__name:"CreateSubcategory",props:{propCategories:{type:Array,default:[]},categories:{type:Array,default:[]}},emits:["createdSubcategory"],setup(_,{emit:f}){const d=_,{triggerPositive:S,triggerNegative:N}=E(),{createSubcategoryInFirebase:b}=P(),o=n(""),u=n([]),m=n(null),r=n(null),v=n(null);O(),w(()=>d.categories,()=>{u.value=d.categories.map(g=>({label:g.categoryName,value:g.categoryId}))});function $(){v.value.validate().then(g=>{g?t():N("Please, fill in all the fields")})}const p=()=>{m.value=null,r.value=null,v.value.reset()},t=async()=>{try{const g={subCategoryName:m.value,subCategoryRoute:r.value};await b(o.value,g),S(`${m.value} subcategory created`),p(),f("createdSubcategory",o.value)}catch(g){console.warn({error:g})}};return(g,i)=>(y(),R("div",Y,[Z,c(B,{ref_key:"createSubcategoryForm",ref:v,onSubmit:$},{default:I(()=>[c(k,{class:"q-pb-lg",outlined:"",modelValue:o.value,"onUpdate:modelValue":i[0]||(i[0]=l=>o.value=l),options:u.value,label:"Parent category route"},null,8,["modelValue","options"]),o.value?(y(),R("div",ee,[c(F,{class:"q-pb-lg",modelValue:m.value,"onUpdate:modelValue":i[1]||(i[1]=l=>m.value=l),outlined:"",label:"Subcategory name *","lazy-rules":"ondemand",rules:[l=>l&&l.length>0||"Name must be filled"]},null,8,["modelValue","rules"]),c(F,{class:"q-pb-lg",modelValue:r.value,"onUpdate:modelValue":i[2]||(i[2]=l=>r.value=l),outlined:"",label:"Subcategory route *",prefix:"/","lazy-rules":"ondemand",rules:[l=>l&&l.length>0||"Route must be filled"]},null,8,["modelValue","rules"]),c(U,{unelevated:"",rounded:"",align:"between","icon-right":"check",color:"primary",label:"Create",type:"submit"})])):h("",!0)]),_:1},512)]))}},te={class:"q-pa-md"},oe=C("h5",{class:"q-pb-md"},"Edit Product Subcategory",-1),re={key:0,class:"q-pb-lg"},se={key:1},ue={class:"row q-gutter-md"},le={class:"q-ml-sm"},ne={__name:"EditSubcategory",props:{categories:{type:Array,default:[]},subcategories:{type:Array,default:[]}},emits:["updatedSubcategory","selectedNewParentCategory","deletedSubcategory"],setup(_,{emit:f}){const d=_,{deleteSubcategoryFromFirebase:S,updateSubcategoryInFirebase:N}=P(),{triggerPositive:b}=E(),o=n(""),u=n(""),m=n([]),r=n(""),v=n([]),$=n(null),p=n(!1),t=x({subCategoryName:"",subCategoryRoute:""}),g={subCategoryName:{required:Q},subCategoryRoute:{required:Q}},i=x({subCategoryName:"",subCategoryRoute:""}),l=L(g,t),z=T(()=>t.subCategoryName!=i.subCategoryName||t.subCategoryRoute!=i.subCategoryRoute);w(()=>d.subcategories,()=>{if(v.value=d.subcategories.map(a=>({label:a.subCategoryName,value:a.subCategoryId})),o.value){let a=d.subcategories.find(s=>s.subCategoryId===o.value);const e={label:a.subCategoryName,value:a.subCategoryId};r.value=e,o.value=""}}),w(()=>d.categories,()=>{m.value=d.categories.map(a=>({label:a.categoryName,value:a.categoryId}))}),w(u,a=>{v.value=[],r.value="",t.subCategoryName="",t.subCategoryRoute="",o.value="",f("selectedNewParentCategory",a)}),w(r,a=>{if(a.value){let e=d.subcategories.find(s=>s.subCategoryId===a.value);i.subCategoryName=e.subCategoryName,i.subCategoryRoute=e.subCategoryRoute,t.subCategoryName=e.subCategoryName,t.subCategoryRoute=e.subCategoryRoute}else return});const M=()=>{v.value=[],r.value="",t.subCategoryName="",t.subCategoryRoute="",$.value.reset()},j=async()=>{if(p.value=!1,!p.value)try{await S(u.value,r.value),b(`${t.subCategoryName} subcategory deleted`),M(),f("deletedSubcategory",u.value)}catch(a){console.warn({error:a})}},H=async()=>{try{const a={subCategoryId:D(r.value).value,subCategoryName:t.subCategoryName,subCategoryRoute:t.subCategoryRoute};o.value=D(r.value).value,await N(u.value,r.value,a),f("updatedSubcategory",u.value),b("Subcategory updated")}catch(a){console.warn({error:a})}};return(a,e)=>(y(),R("div",te,[oe,c(B,{ref_key:"editSubcategoryForm",ref:$,onSubmit:H},{default:I(()=>[c(k,{class:"q-pb-lg",modelValue:u.value,"onUpdate:modelValue":e[0]||(e[0]=s=>u.value=s),options:m.value,outlined:"",label:"Parent category route"},null,8,["modelValue","options"]),u.value?(y(),R("div",re,[_.subcategories.length?(y(),q(k,{key:0,outlined:"",class:"q-pb-lg",modelValue:r.value,"onUpdate:modelValue":e[1]||(e[1]=s=>r.value=s),options:v.value,label:"Subcategory"},null,8,["modelValue","options"])):(y(),R("p",se,"No subcategories. Add the first one on the left")),r.value?(y(),q(F,{key:2,outlined:"",class:"q-pb-lg",modelValue:t.subCategoryName,"onUpdate:modelValue":e[2]||(e[2]=s=>t.subCategoryName=s),label:"Edit name",onInput:e[3]||(e[3]=s=>V(l).subCategoryName.$touch()),error:V(l).subCategoryName.$invalid},null,8,["modelValue","error"])):h("",!0),r.value?(y(),q(F,{key:3,outlined:"",class:"q-pb-lg",modelValue:t.subCategoryRoute,"onUpdate:modelValue":e[4]||(e[4]=s=>t.subCategoryRoute=s),prefix:"/",label:"Edit route",onInput:e[5]||(e[5]=s=>V(l).subCategoryRoute.$touch()),error:V(l).subCategoryRoute.$invalid},null,8,["modelValue","error"])):h("",!0),C("div",ue,[c(U,{unelevated:"",rounded:"",align:"between",color:"primary","icon-right":"delete",label:"Delete",onClick:e[6]||(e[6]=s=>p.value=!0)}),c(U,{unelevated:"",rounded:"",align:"between","icon-right":"sync",color:"primary",label:"Update",disabled:!V(z),type:"submit"},null,8,["disabled"])]),c(X,{open:p.value,"onUpdate:open":e[7]||(e[7]=s=>p.value=s),onCancel:e[8]||(e[8]=s=>p.value=!1),onSubmit:j},{default:I(()=>[c(G,{icon:"error",color:"red","text-color":"white"}),C("span",le,[A("Are you sure you want to delete "),C("b",null,K(t.subCategoryName),1),A(" ?")])]),_:1},8,["open"])])):h("",!0)]),_:1},512)]))}};const ce={class:"row justify-center"},de={class:"col-12 col-sm-6 col-md-4"},ge={class:"col-12 col-sm-6 col-md-4"},pe={__name:"Subcategories",setup(_){O();const{getCategoryDocsFromFirebase:f,getSubcategoryDocsFromFirebase:d}=P(),S=n([]),N=n([]);W(async()=>{try{const{categoriesData:o}=await f();S.value=o.value}catch(o){console.warn({error:o})}});async function b(o){try{const{subcategoriesData:u}=await d(o);N.value=u.value}catch(u){console.error({error:u})}}return(o,u)=>(y(),q(J,null,{default:I(()=>[C("div",ce,[C("div",de,[c(ae,{categories:S.value,onCreatedSubcategory:b},null,8,["categories"])]),C("div",ge,[c(ne,{categories:S.value,subcategories:N.value,onUpdatedSubcategory:b,onSelectedNewParentCategory:b,onDeletedSubcategory:b},null,8,["categories","subcategories"])])])]),_:1}))}};export{pe as default};
