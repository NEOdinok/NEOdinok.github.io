import{b as O,u as z,a as A,Q as R}from"./QSelect.fab3c088.js";import{a as w,c as H,r as u,w as D,l as W,h,ay as G,b as J,bw as K,a1 as L,a7 as k,ag as j,ab as m,a9 as S,ae as y,ad as V,bv as X,f as I,ac as x,bs as Y,af as Z,aN as ee,ai as E,o as te,a8 as U,ah as ae,al as le}from"./index.fe5df578.js";import{Q as oe}from"./QPage.a68ccd5a.js";import{_ as re}from"./ConfirmationModal.99570e08.js";import{_ as ie}from"./plugin-vue_export-helper.21dcd24c.js";import"./format.40ec3e95.js";const ne={ratio:[String,Number]};function se(e,c){return w(()=>{const r=Number(e.ratio||(c!==void 0?c.value:void 0));return isNaN(r)!==!0&&r>0?{paddingBottom:`${100/r}%`}:null})}const ue=16/9;var ce=H({name:"QImg",props:{...ne,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:ue},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:c,emit:r}){const p=u(e.initialRatio),C=se(e,p);let t=null,o=!1;const i=[u(null),u(_())],s=u(0),b=u(!1),d=u(!1),g=w(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),f=w(()=>({width:e.width,height:e.height})),Q=w(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),B=w(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));D(()=>F(),q);function F(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function _(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function q(a){t!==null&&(clearTimeout(t),t=null),d.value=!1,a===null?(b.value=!1,i[s.value^1].value=_()):b.value=!0,i[s.value].value=a}function l({target:a}){o!==!0&&(t!==null&&(clearTimeout(t),t=null),p.value=a.naturalHeight===0?.5:a.naturalWidth/a.naturalHeight,n(a,1))}function n(a,N){o===!0||N===1e3||(a.complete===!0?v(a):t=setTimeout(()=>{t=null,n(a,N+1)},50))}function v(a){o!==!0&&(s.value=s.value^1,i[s.value].value=null,b.value=!1,d.value=!1,r("load",a.currentSrc||a.src))}function T(a){t!==null&&(clearTimeout(t),t=null),b.value=!1,d.value=!0,i[s.value].value=null,i[s.value^1].value=_(),r("error",a)}function P(a){const N=i[a].value,$={key:"img_"+a,class:Q.value,style:B.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...N};return s.value===a?($.class+=" q-img__image--waiting",Object.assign($,{onLoad:l,onError:T})):$.class+=" q-img__image--loaded",h("div",{class:"q-img__container absolute-full",key:"img"+a},h("img",$))}function M(){return b.value!==!0?h("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},J(c[d.value===!0?"error":"default"])):h("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},c.loading!==void 0?c.loading():e.noSpinner===!0?void 0:[h(K,{color:e.spinnerColor,size:e.spinnerSize})])}return q(F()),W(()=>{o=!0,t!==null&&(clearTimeout(t),t=null)}),()=>{const a=[];return C.value!==null&&a.push(h("div",{key:"filler",style:C.value})),d.value!==!0&&(i[0].value!==null&&a.push(P(0)),i[1].value!==null&&a.push(P(1))),a.push(h(G,{name:"q-transition--fade"},M)),h("div",{class:g.value,style:f.value,role:"img","aria-label":e.alt},a)}}});const de={class:"absolute-bottom"},ge={class:"text-h6"},ve={class:"text-subtitle2"},me={class:"q-ml-sm"},fe={__name:"ProductCard",props:{name:{type:String,required:!1},price:{type:Number,required:!1},description:{type:String,required:!1},mainImgUrl:{type:String,required:!1},imagesData:{type:Array,required:!1},id:{type:String,required:!1}},emits:["productDelete"],setup(e,{emit:c}){const r=e,{removeImageFromFirebaseStorage:p}=O(),{deleteProductFromFirebase:C}=z(),{triggerPositive:t}=A(),o=u(!1),i=L(),s=()=>{i.push(`/products/edit/${r.id}`)},b=async()=>{if(o.value=!1,console.log("bout to delete:",r.name),o.value==!1)try{r.imagesData.map(async d=>await p(d)),await C(r.id),t(`${r.name} product deleted`),c("productDelete")}catch(d){console.warn({error:d})}};return(d,g)=>(k(),j(E,null,[m(Y,null,{default:S(()=>[m(ce,{src:r.mainImgUrl,ratio:"1",fit:"cover"},{default:S(()=>[y("div",de,[y("div",ge,V(r.name),1),y("div",ve,V(r.price)+" \u20BD",1)])]),_:1},8,["src"]),m(X,null,{default:S(()=>[m(I,{flat:"",onClick:g[0]||(g[0]=f=>o.value=!0)},{default:S(()=>[x("Delete")]),_:1}),m(I,{flat:"",onClick:s},{default:S(()=>[x("Edit")]),_:1})]),_:1})]),_:1}),m(ee,{modelValue:o.value,"onUpdate:modelValue":g[3]||(g[3]=f=>o.value=f)},{default:S(()=>[m(re,{open:o.value,"onUpdate:open":g[1]||(g[1]=f=>o.value=f),onCancel:g[2]||(g[2]=f=>o.value=!1),onSubmit:b},{default:S(()=>[m(Z,{icon:"error",color:"red","text-color":"white"}),y("span",me,"\u0412\u044B \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u044C\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0440\u043E\u0434\u0443\u043A\u0442 "+V(r.name)+" ?",1)]),_:1},8,["open"])]),_:1},8,["modelValue"])],64))}};const ye={class:"row justify-center"},be={class:"content col no-wrap"},_e={class:"topRow"},he={class:"filtersRow"},Se={class:"btnsRow"},pe={class:"cardsSection"},Ce={__name:"ProductList",setup(e){const c=u(""),r=u(""),p=u([]),C=u([]),t=u(null),o=u(null),i=u([]),s=u([]),b=L(),{getCategoryDocsFromFirebase:d,getSubcategoryDocsFromFirebase:g,getProductDocsFromFirebase:f}=z();te(async()=>{try{const{categoriesData:l}=await d(),{productsData:n}=await f();c.value=l.value,i.value=n,i.value&&_()}catch(l){console.warn({error:l})}});const Q=()=>{b.push("/products/create")},B=async()=>{try{const{productsData:l}=await f();i.value=l,i.value&&_()}catch(l){console.warn({error:l})}},F=()=>{t.value=null,o.value=null},_=()=>{t.value&&o.value?s.value=i.value.filter(l=>(console.log("p.cat:",l.category.label,"p.subCat:",l.subCategory.label),l.category.label===t.value.label&&l.subCategory.label===o.value.label)):t.value?s.value=i.value.filter(l=>l.category.label===t.value.label):s.value=i.value},q=async l=>{try{const{subcategoriesData:n}=await g(l);r.value=n.value}catch(n){console.error({error:n})}};return D(t,()=>{t.value&&q(t.value),o.value=null,_()}),D(o,()=>{_()}),D(c,()=>{p.value=c.value.map(l=>({label:l.categoryName,value:l.categoryId}))}),D(r,()=>{C.value=r.value.map(l=>({label:l.subCategoryName,value:l.subCategoryId}))}),(l,n)=>(k(),U(oe,null,{default:S(()=>[y("div",ye,[y("div",be,[y("div",_e,[y("div",he,[m(R,{class:"categoryFilter filterInput",outlined:"",label:"Product category",modelValue:t.value,"onUpdate:modelValue":n[0]||(n[0]=v=>t.value=v),options:p.value},null,8,["modelValue","options"]),m(R,{class:"subCategoryFilter filterInput",outlined:"",label:"Product Subcategory",modelValue:o.value,"onUpdate:modelValue":n[1]||(n[1]=v=>o.value=v),options:C.value},null,8,["modelValue","options"]),m(I,{unelevated:"",rounded:"",class:"createBtn btn",align:"between","icon-right":"clear",color:"primary",label:"Clear",onClick:n[2]||(n[2]=v=>F())})]),y("div",Se,[m(I,{"no-caps":"",class:"createBtn btn",align:"between","icon-right":"add",color:"positive",label:"Create Product",onClick:Q})])]),y("div",pe,[i.value.length!=0?(k(!0),j(E,{key:0},ae(s.value,(v,T)=>(k(),U(fe,{onProductDelete:n[3]||(n[3]=()=>B()),name:v.name,price:+v.price,mainImgUrl:v.imagesData.filter(P=>P.isMain==="true")[0].url,imagesData:v.imagesData,id:v.id},null,8,["name","price","mainImgUrl","imagesData","id"]))),256)):le("",!0)])])])]),_:1}))}};var $e=ie(Ce,[["__scopeId","data-v-c4828046"]]);export{$e as default};
