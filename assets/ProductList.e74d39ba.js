import{u as L,a as A,Q as x}from"./QSelect.f94f63f8.js";import{a as w,c as H,r as u,w as D,l as W,h as _,ay as G,b as J,bw as j,a1 as E,a7 as C,ag as Q,ab as d,a9 as h,ae as y,ad as V,bv as K,f as B,ac as z,bs as X,af as Y,aN as Z,ai as M,o as ee,a8 as U,ah as te}from"./index.544219da.js";import{Q as ae}from"./QPage.8dc521cc.js";import{_ as le}from"./ConfirmationModal.546b979c.js";import{_ as ie}from"./plugin-vue_export-helper.21dcd24c.js";import"./format.3ab41e4b.js";const oe={ratio:[String,Number]};function re(e,g){return w(()=>{const i=Number(e.ratio||(g!==void 0?g.value:void 0));return isNaN(i)!==!0&&i>0?{paddingBottom:`${100/i}%`}:null})}const ne=16/9;var se=H({name:"QImg",props:{...oe,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:ne},placeholderSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:g,emit:i}){const S=u(e.initialRatio),p=re(e,S);let t=null,c=!1;const o=[u(null),u(b())],s=u(0),m=u(!1),n=u(!1),f=w(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),q=w(()=>({width:e.width,height:e.height})),I=w(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition`),T=w(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));D(()=>P(),F);function P(){return e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null}function b(){return e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null}function F(a){t!==null&&(clearTimeout(t),t=null),n.value=!1,a===null?(m.value=!1,o[s.value^1].value=b()):m.value=!0,o[s.value].value=a}function l({target:a}){c!==!0&&(t!==null&&(clearTimeout(t),t=null),S.value=a.naturalHeight===0?.5:a.naturalWidth/a.naturalHeight,r(a,1))}function r(a,N){c===!0||N===1e3||(a.complete===!0?v(a):t=setTimeout(()=>{t=null,r(a,N+1)},50))}function v(a){c!==!0&&(s.value=s.value^1,o[s.value].value=null,m.value=!1,n.value=!1,i("load",a.currentSrc||a.src))}function R(a){t!==null&&(clearTimeout(t),t=null),m.value=!1,n.value=!0,o[s.value].value=null,o[s.value^1].value=b(),i("error",a)}function k(a){const N=o[a].value,$={key:"img_"+a,class:I.value,style:T.value,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...N};return s.value===a?($.class+=" q-img__image--waiting",Object.assign($,{onLoad:l,onError:R})):$.class+=" q-img__image--loaded",_("div",{class:"q-img__container absolute-full",key:"img"+a},_("img",$))}function O(){return m.value!==!0?_("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},J(g[n.value===!0?"error":"default"])):_("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},g.loading!==void 0?g.loading():e.noSpinner===!0?void 0:[_(j,{color:e.spinnerColor,size:e.spinnerSize})])}return F(P()),W(()=>{c=!0,t!==null&&(clearTimeout(t),t=null)}),()=>{const a=[];return p.value!==null&&a.push(_("div",{key:"filler",style:p.value})),n.value!==!0&&(o[0].value!==null&&a.push(k(0)),o[1].value!==null&&a.push(k(1))),a.push(_(G,{name:"q-transition--fade"},O)),_("div",{class:f.value,style:q.value,role:"img","aria-label":e.alt},a)}}});const ue={class:"absolute-bottom"},ce={class:"text-h6"},de={class:"text-subtitle2"},ge={class:"q-ml-sm"},ve={__name:"ProductCard",props:{name:{type:String,required:!1},price:{type:Number,required:!1},description:{type:String,required:!1},mainImgUrl:{type:String,required:!1},imagesData:{type:Array,required:!1},id:{type:String,required:!1}},emits:["productDelete"],setup(e,{emit:g}){const i=e,{deleteProductFromFirebase:S}=L(),{triggerPositive:p}=A(),t=u(!1),c=E(),o=()=>{c.push(`/products/edit/${i.id}`)},s=async()=>{if(t.value=!1,console.log("bout to delete:",i.name),t.value==!1)try{await S(i.id),p(`${i.name} product deleted`),g("productDelete")}catch(m){console.warn({error:m})}};return(m,n)=>(C(),Q(M,null,[d(X,null,{default:h(()=>[d(se,{src:i.mainImgUrl,ratio:"1",fit:"cover","spinner-color":"primary"},{default:h(()=>[y("div",ue,[y("div",ce,V(i.name),1),y("div",de,V(i.price)+" \u20BD",1)])]),_:1},8,["src"]),d(K,null,{default:h(()=>[d(B,{flat:"",onClick:n[0]||(n[0]=f=>t.value=!0)},{default:h(()=>[z("Delete")]),_:1}),d(B,{flat:"",onClick:o},{default:h(()=>[z("Edit")]),_:1})]),_:1})]),_:1}),d(Z,{modelValue:t.value,"onUpdate:modelValue":n[3]||(n[3]=f=>t.value=f)},{default:h(()=>[d(le,{open:t.value,"onUpdate:open":n[1]||(n[1]=f=>t.value=f),onCancel:n[2]||(n[2]=f=>t.value=!1),onSubmit:s},{default:h(()=>[d(Y,{icon:"error",color:"red","text-color":"white"}),y("span",ge,"\u0412\u044B \u0434\u0435\u0439\u0441\u0442\u0432\u0438\u0442\u0435\u043B\u044C\u043D\u043E \u0445\u043E\u0442\u0438\u0442\u0435 \u0443\u0434\u0430\u043B\u0438\u0442\u044C \u043F\u0440\u043E\u0434\u0443\u043A\u0442 "+V(i.name)+" ?",1)]),_:1},8,["open"])]),_:1},8,["modelValue"])],64))}};const me={class:"row justify-center"},fe={class:"content col no-wrap"},ye={class:"topRow"},be={class:"filtersRow"},_e={class:"btnsRow"},he={key:0,class:"cardsSection"},Se={key:1,class:"spinnerWrap"},pe={__name:"ProductList",setup(e){const g=u(""),i=u(""),S=u([]),p=u([]),t=u(null),c=u(null),o=u([]),s=u([]),m=E(),{getCategoryDocsFromFirebase:n,getSubcategoryDocsFromFirebase:f,getProductDocsFromFirebase:q}=L();ee(async()=>{try{const{categoriesData:l}=await n(),{productsData:r}=await q();g.value=l.value,o.value=r,o.value&&b()}catch(l){console.warn({error:l})}});const I=()=>{m.push("/products/create")},T=async()=>{try{const{productsData:l}=await q();o.value=l,o.value&&b()}catch(l){console.warn({error:l})}},P=()=>{t.value=null,c.value=null},b=()=>{t.value&&c.value?s.value=o.value.filter(l=>(console.log("p.cat:",l.category.label,"p.subCat:",l.subCategory.label),l.category.label===t.value.label&&l.subCategory.label===c.value.label)):t.value?s.value=o.value.filter(l=>l.category.label===t.value.label):s.value=o.value},F=async l=>{try{const{subcategoriesData:r}=await f(l);i.value=r.value}catch(r){console.error({error:r})}};return D(t,()=>{t.value&&F(t.value),c.value=null,b()}),D(c,()=>{b()}),D(g,()=>{S.value=g.value.map(l=>({label:l.categoryName,value:l.categoryId}))}),D(i,()=>{p.value=i.value.map(l=>({label:l.subCategoryName,value:l.subCategoryId}))}),(l,r)=>(C(),U(ae,null,{default:h(()=>[y("div",me,[y("div",fe,[y("div",ye,[y("div",be,[d(x,{class:"categoryFilter filterInput",outlined:"",label:"Product category",modelValue:t.value,"onUpdate:modelValue":r[0]||(r[0]=v=>t.value=v),options:S.value},null,8,["modelValue","options"]),d(x,{class:"subCategoryFilter filterInput",outlined:"",label:"Product Subcategory",modelValue:c.value,"onUpdate:modelValue":r[1]||(r[1]=v=>c.value=v),options:p.value},null,8,["modelValue","options"]),d(B,{unelevated:"",rounded:"",class:"createBtn btn",align:"between","icon-right":"clear",color:"primary",label:"Clear",disabled:!t.value,onClick:r[2]||(r[2]=v=>P())},null,8,["disabled"])]),y("div",_e,[d(B,{"no-caps":"",class:"createBtn btn",align:"between","icon-right":"add",color:"positive",label:"Create Product",onClick:I})])]),o.value.length!=0?(C(),Q("div",he,[(C(!0),Q(M,null,te(s.value,(v,R)=>(C(),U(ve,{onProductDelete:r[3]||(r[3]=()=>T()),name:v.name,price:+v.price,mainImgUrl:v.imagesData.find(k=>k.isMain===!0).url,imagesData:v.imagesData,id:v.id},null,8,["name","price","mainImgUrl","imagesData","id"]))),256))])):(C(),Q("div",Se,[d(j,{color:"primary",size:"3em"})]))])])]),_:1}))}};var ke=ie(pe,[["__scopeId","data-v-17c6ae73"]]);export{ke as default};
