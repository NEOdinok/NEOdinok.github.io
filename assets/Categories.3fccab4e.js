import{Q as j}from"./QPage.8dc521cc.js";import{r as c,a4 as D,a7 as C,ag as h,ab as o,a9 as _,aL as q,f as F,ae as v,aJ as U,a as H,w as k,a8 as B,aM as $,al as J,af as L,ac as I,ad as T,aN as G,aO as K,o as W}from"./index.544219da.js";import{Q as S}from"./QForm.129fbcb6.js";import{u as Q,a as A,Q as X}from"./QSelect.f94f63f8.js";import{u as Y,r as x}from"./index.6b351daa.js";import{_ as Z}from"./ConfirmationModal.546b979c.js";import"./format.3ab41e4b.js";const ee={class:"q-pa-md"},te=v("h5",{class:"q-pb-md"},"Create new product category",-1),ae={__name:"CreateCategory",emits:["createdCategory"],setup(R,{emit:g}){const{createCategoryInFirebase:d}=Q(),{triggerNegative:p,triggerPositive:s}=A(),i=c(null),b=c(null),y=c(null);D();const r=()=>{i.value=null,b.value=null,y.value.reset()};function N(){y.value.validate().then(f=>{f?V():p("Please, fill in all the fields")})}const V=async()=>{let f={categoryName:i.value,categoryRoute:b.value};await d(f),s(`Category ${i.value} created`),g("createdCategory"),r()};return(f,l)=>(C(),h("div",ee,[te,o(S,{ref_key:"createCategoryForm",ref:y,onSubmit:N},{default:_(()=>[o(q,{class:"q-pb-lg",modelValue:i.value,"onUpdate:modelValue":l[0]||(l[0]=u=>i.value=u),outlined:"",label:"Category name *","lazy-rules":"ondemand",rules:[u=>u&&u.length>0||"Name must be filled"]},null,8,["modelValue","rules"]),o(q,{class:"q-pb-lg",modelValue:b.value,"onUpdate:modelValue":l[1]||(l[1]=u=>b.value=u),outlined:"",label:"Route for category *",prefix:"/","lazy-rules":"ondemand",rules:[u=>u&&u.length>0||"Route must be filled in."]},null,8,["modelValue","rules"]),o(F,{unelevated:"",rounded:"",align:"between","icon-right":"check",color:"primary",label:"Create",type:"submit"})]),_:1},512)]))}},oe={class:"q-pa-md"},re=v("h5",{class:"q-pb-md"},"Edit Product Category",-1),le={key:1},se={key:2,class:"q-pb-lg"},ue={class:"row q-gutter-sm"},ne={class:"q-ml-sm"},ce={__name:"EditCategory",props:{categories:{type:Array,default:[]}},emits:["updatedCategory","deletedCategory"],setup(R,{emit:g}){const d=R,{updateCategoryInFirebase:p,deleteCategoryFromFirebase:s}=Q(),{triggerPositive:i,triggerNegative:b}=A(),y=c(""),r=c(null),N=c([]),V=c(null),f=c(null),l=c(!1),u=c(""),n=U({categoryName:"",categoryRoute:""}),E={categoryName:{required:x},categoryRoute:{required:x}},m=U({categoryName:"",categoryRoute:""}),P=H(()=>n.categoryName!=m.categoryName||n.categoryRoute!=m.categoryRoute),w=Y(E,n),z=async()=>{try{const a={categoryName:n.categoryName,categoryRoute:n.categoryRoute};y.value=K(r.value).value,await p(r.value,a),i("Cateogory updated"),m.categoryName="",m.categoryRoute="",g("updatedCategory",r.value)}catch(a){console.warn({error:a})}},M=()=>{N.value=[],r.value="",V.value="",f.value="",u.value.reset()},O=async()=>{if(l.value=!1,!l.value)try{await s(r.value),i(`${V.value} category deleted`),M(),m.categoryName="",m.categoryRoute="",g("deletedCategory",r.value)}catch(a){console.warn({error:a})}};return k(()=>d.categories,()=>{if(N.value=d.categories.map(a=>({label:a.categoryName,value:a.categoryId})),y.value){let a=d.categories.find(t=>t.categoryId===y.value),e={label:a.categoryName,value:a.categoryId};r.value=e,y.value=""}}),k(r,a=>{if(a.value){let e=d.categories.find(t=>t.categoryId===a.value);m.categoryName=e.categoryName,m.categoryRoute=e.categoryRoute,n.categoryName=e.categoryName,n.categoryRoute=e.categoryRoute}else return}),(a,e)=>(C(),h("div",oe,[re,o(S,{ref_key:"editCategoryForm",ref:u,onSubmit:z},{default:_(()=>[R.categories.length?(C(),B(X,{key:0,class:"q-pb-lg",modelValue:r.value,"onUpdate:modelValue":e[0]||(e[0]=t=>r.value=t),options:N.value,outlined:"",label:"Available categories"},null,8,["modelValue","options"])):(C(),h("p",le,"No categories. Create the first one on the left")),r.value?(C(),h("div",se,[o(q,{class:"q-pb-lg",modelValue:n.categoryName,"onUpdate:modelValue":e[1]||(e[1]=t=>n.categoryName=t),outlined:"",label:"Edit name","bottom-slots":"",onInput:e[2]||(e[2]=t=>$(w).categoryName.$touch()),error:$(w).categoryName.$invalid},null,8,["modelValue","error"]),o(q,{modelValue:n.categoryRoute,"onUpdate:modelValue":e[3]||(e[3]=t=>n.categoryRoute=t),prefix:"/",outlined:"",label:"Edit route","bottom-slots":"",onInput:e[4]||(e[4]=t=>$(w).categoryRoute.$touch()),error:$(w).categoryRoute.$invalid},null,8,["modelValue","error"]),v("div",ue,[o(F,{unelevated:"",rounded:"",align:"between",color:"primary","icon-right":"delete",label:"Delete",onClick:e[5]||(e[5]=t=>l.value=!0)}),o(F,{disable:!P.value,unelevated:"",rounded:"",align:"between","icon-right":"sync",color:"primary",label:"Update",type:"submit"},null,8,["disable"])])])):J("",!0)]),_:1},512),o(G,{modelValue:l.value,"onUpdate:modelValue":e[8]||(e[8]=t=>l.value=t)},{default:_(()=>[o(Z,{open:l.value,"onUpdate:open":e[6]||(e[6]=t=>l.value=t),onCancel:e[7]||(e[7]=t=>l.value=!1),onSubmit:O},{default:_(()=>[o(L,{icon:"error",color:"red","text-color":"white"}),v("span",ne,[I("Are you sure you want to delete "),v("b",null,T(n.categoryName),1),I(" ?")])]),_:1},8,["open"])]),_:1},8,["modelValue"])]))}},de={class:"row justify-center"},ie={class:"col-12 col-sm-6 col-md-4"},ge={class:"col-12 col-sm-6 col-md-4"},Ne={__name:"Categories",setup(R){D();const g=c([]),{getCategoryDocsFromFirebase:d}=Q();W(async()=>{try{const{categoriesData:s}=await d();g.value=s.value}catch(s){console.warn({error:s})}});async function p(){try{const{categoriesData:s}=await d();g.value=s.value}catch(s){console.error({error:s})}}return(s,i)=>(C(),B(j,null,{default:_(()=>[v("div",de,[v("div",ie,[o(ae,{onCreatedCategory:p})]),v("div",ge,[o(ce,{categories:g.value,onUpdatedCategory:p,onDeletedCategory:p},null,8,["categories"])])])]),_:1}))}};export{Ne as default};
